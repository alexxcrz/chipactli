<link rel="stylesheet" href="modales.css">
<link rel="stylesheet" href="admin.css">
<link rel="stylesheet" href="menu-lateral.css">
<!-- MODAL: Productos pendientes o incompletos -->
<div id="modalPendientesInsumos" class="modal">
  <div class="contenidoModal" style="max-width:600px">
    <div class="encabezadoModal">
      <h3>Productos pendientes o incompletos</h3>
      <button class="cerrarModal" onclick="cerrarModal('modalPendientesInsumos')">&times;</button>
    </div>
    <div id="cuerpoPendientesInsumos" style="padding:20px;max-height:55vh;overflow-y:auto;"></div>
  </div>
</div>
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="pageTitle">Chipactli - Gesti√≥n Bot√°nica y Herbolaria</title>
<meta name="description" content="Chipactli: sistema profesional para gesti√≥n de inventario, recetas, producci√≥n y ventas en bot√°nica y herbolaria. Seguridad, control y administraci√≥n avanzada.">
<meta name="keywords" content="bot√°nica, herbolaria, inventario, recetas, producci√≥n, ventas, gesti√≥n, plantas, ra√≠ces, cosm√©tica s√≥lida, administraci√≥n, Chipactli">
<meta name="author" content="Alejandro Cruz">
<meta property="og:title" content="Chipactli - Gesti√≥n Bot√°nica y Herbolaria">
<meta property="og:description" content="Sistema profesional para gesti√≥n de inventario, recetas y ventas en bot√°nica y herbolaria.">
<meta property="og:image" content="/images/logo.png">
<meta property="og:type" content="website">
<meta property="og:url" content="https://chipactli.com/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Chipactli - Gesti√≥n Bot√°nica y Herbolaria">
<meta name="twitter:description" content="Sistema profesional para gesti√≥n de inventario, recetas y ventas en bot√°nica y herbolaria.">
<meta name="twitter:image" content="/images/logo.png">
<link rel="icon" type="image/png" href="/images/favicon.ico">
<link rel="apple-touch-icon" href="/images/logo.png">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#4CAF50">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Chipactli">
<link rel="stylesheet" href="login.css">
<!-- Suprimir error de Chrome extensions -->
<script>
window.addEventListener('error', (e) => {
  if (e.message && e.message.includes('message channel closed')) {
    e.preventDefault();
  }
}, true);
</script>
<style>
/* Header Card Fijo */
.headerCardFijo {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  z-index: 2002;
  background: linear-gradient(180deg, #f5f1e8 0%, #f0ebe0 100%);
  border-radius: 30px;
  border-bottom: 2px solid #2a2a2a;
  box-shadow: 0 6px 16px rgba(0,0,0,0.1);
  display: flex;
  align-items: center;
  gap: 18px;
  justify-content: flex-start;
  padding: 12px 24px;
  height: 90px;
}
.headerCardFijo .botonToggleMenu {
  position: static;
  margin-right: 8px;
}
.headerCardFijo #logoEncabezado {
  width: 62px;
  height: 62px;
  border-radius: 50%;
  object-fit: cover;
  background: white;
  padding: 2px;
  box-shadow: 0 6px 14px rgba(74,124,89,0.3);
  border: 3px solid #2a2a2a;
}
.headerCardFijo .tituloEncabezado {
  color: var(--primary);
  font-size: 22px;
  font-weight: 800;
  margin: 0 12px 0 0;
  text-align: left;
}
.headerCardFijo .iconoAlertas {
  position: static;
  width: 42px;
  height: 42px;
  font-size: 18px;
  border-radius: 18px;
  background: rgba(74,124,89,0.1);
  border: 2px solid #2a2a2a;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s;
  color: var(--primary);
}
.headerCardFijo .iconoAlertas:hover {
  background: var(--primary);
  color: white;
  transform: scale(1.1);
}
.headerCardFijo .distintivo {
  position: absolute;
  top: -8px;
  right: -8px;
}
.contenidoPrincipal {
  margin-top: 100px !important;
}
:root {
  --primary: #4a7c59;
  --primary-dark: #3a6449;
  --secondary: #8b7355;
  --success: #6b9e6f;
  --danger: #c75550;
  --warning: #d4a574;
  --bg-dark: #f5f1e8;
  --bg-secondary: #ebe5d9;
  --bg-tertiary: #d9cfc0;
  --text-primary: #3a3a3a;
  --text-secondary: #6b6b6b;
  --border-color: #d4ccc0;
  --card-bg: #ffffff;
  --header-bg: #f5f1e8;
  --pendiente-color: #d32f2f;
  --pendiente-bg: #fff8f8;
}
/* Insumo pendiente: color y efecto igual en PC y m√≥vil */
.insumoPendiente td {
  color: var(--pendiente-color) !important;
  font-weight: bold;
  background: var(--pendiente-bg);
}
.campoEditablePendiente {
  border: 2px dashed var(--pendiente-color) !important;
  background: var(--pendiente-bg) !important;
}
@media (max-width: 600px) {
  .insumoPendiente td {
    color: var(--pendiente-color) !important;
    font-weight: bold;
    background: var(--pendiente-bg);
  }
  .campoEditablePendiente {
    border: 2px dashed var(--pendiente-color) !important;
    background: var(--pendiente-bg) !important;
  }
}
<script>
// Cerrar men√∫ lateral al tocar fuera
document.addEventListener('DOMContentLoaded', function() {
  const barra = document.querySelector('.barraLateral');
  document.addEventListener('click', function(e) {
    if (barra && barra.classList.contains('mostrada')) {
      // Si el click es fuera del sidebar
      if (!barra.contains(e.target)) {
        barra.classList.remove('mostrada');
      }
    }
  });
});
</script>

link[rel="icon"] { border-radius: 50%; }
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Inter','Segoe UI',Tahoma,Geneva,Verdana,sans-serif; color:var(--text-primary); overflow-x:hidden; background: url('images/fondos.png') center center/cover no-repeat fixed, #e8d7b1; }



/* ===== MAIN CONTENT ===== */
.contenidoPrincipal { margin:0; padding:15px; transition:margin-left 0.3s; box-sizing:border-box; height:auto; position:relative; z-index:1; overflow-x:hidden; border-radius:0 !important; box-shadow:none !important; }

header { background:linear-gradient(135deg, rgba(74,124,89,0.08) 0%, rgba(139,115,85,0.05) 100%); padding:18px 18px; border-radius:30px; border:2px solid #2a2a2a; box-shadow:0 6px 16px rgba(0,0,0,0.1); margin-bottom:18px; display:flex; align-items:center; justify-content:center; flex-direction:column; width:100%; box-sizing:border-box; gap:12px; position:relative; }
.tituloEncabezado { color:var(--primary); font-size:26px; font-weight:800; text-align:center; margin:0; }

#logoEncabezado { width:75px; height:75px; border-radius:50%; object-fit:cover; background:white; padding:2px; box-shadow:0 6px 14px rgba(74,124,89,0.3); border:3px solid #2a2a2a; order:-1; }

.iconoAlertas { position:absolute; cursor:pointer; font-size:16px; padding:10px; background:rgba(74,124,89,0.1); border:2px solid #2a2a2a; border-radius:18px; width:42px; height:42px; display:flex; align-items:center; justify-content:center; transition:all 0.3s; color:var(--primary); z-index:2000; right:18px; top:18px; }
.iconoAlertas:hover { background:var(--primary); color:white; transform:scale(1.1); }

.distintivo { position:absolute; top:-8px; right:-8px; background:#2a2a2a; color:white; border-radius:50%; width:26px; height:26px; display:flex; align-items:center; justify-content:center; font-size:12px; font-weight:bold; box-shadow:0 2px 8px rgba(42,42,42,0.4); }
.distintivo.oculto { display:none; }

.desplegableAlertas { position:absolute; top:65px; right:15px; background:var(--card-bg); border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.15); width:320px; max-height:400px; overflow-y:auto; display:none; z-index:2001; border:2px solid #2a2a2a; }
.desplegableAlertas.mostrado { display:block; }

.tabsAlertas { display:flex; gap:6px; padding:10px 12px; border-bottom:2px solid #2a2a2a; }
.tabAlerta { flex:1; padding:8px 10px; border:1px solid var(--border-color); background:rgba(74,124,89,0.05); border-radius:12px; cursor:pointer; font-size:11px; font-weight:600; color:var(--text-secondary); transition:all 0.3s; }
.tabAlerta.activa { background:var(--primary); color:white; border-color:var(--primary); }

.contenidoAlertas { padding:0 0 8px 0; }
.listaAlertas { max-height:350px; overflow-y:auto; }
.listaAlertas.oculto { display:none; }
.elementoAlerta { padding:12px; border-bottom:1px solid var(--border-color); cursor:pointer; transition:background 0.2s; color:var(--text-secondary); }
.elementoAlerta:last-child { border-bottom:none; }
.elementoAlerta:hover { background:rgba(74,124,89,0.05); }
.fechaAlerta { font-size:11px; color:var(--text-secondary); margin-top:4px; }
.elementoAlerta.advertencia { background:rgba(212,165,116,0.1); border-left:4px solid var(--warning); }

/* ===== TABS/PESTANAS ===== */
.pestana { display:none; width:100%; max-width:100%; border-radius:0 !important; box-shadow:none !important; box-sizing: border-box; }
.pestana.activo { display:block; animation:aparecer 0.3s; width:100%; max-width:100%; border-radius:0 !important; box-shadow:none !important; box-sizing: border-box; }
@keyframes aparecer { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

/* ===== CARDS ===== */
.tarjeta { background:var(--card-bg); padding:22px; border-radius:30px; box-shadow:0 6px 16px rgba(0,0,0,0.1); margin-bottom:18px; width:100%; box-sizing:border-box; border:2px solid #2a2a2a; transition:all 0.3s; }
.tarjeta { width:100%; max-width:100%; box-sizing: border-box; }
.tarjeta:hover { border-color:var(--primary); box-shadow:0 12px 28px rgba(74,124,89,0.18); transform:translateY(-4px); }
.tarjeta h2 { color:var(--primary); margin-bottom:0; font-size:22px; font-weight:800; }

.encabezadoTarjeta { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; margin-bottom:18px; }
.encabezadoTarjeta h2 { margin-bottom:0; }
.encabezadoTarjeta > div { display:flex; gap:10px; align-items:center; flex-wrap:wrap; max-width:100%; }

/* ===== BUTTONS ===== */
.boton { background:var(--card-bg); color:var(--primary); border:2px solid #2a2a2a; padding:8px 16px; border-radius:18px; cursor:pointer; font-size:11px; font-weight:700; transition:all 0.3s; margin-right:5px; }
.boton:hover { background:var(--primary); color:white; transform:translateY(-3px); box-shadow:0 8px 16px rgba(74,124,89,0.25); border-color:var(--primary); }
.boton.activo { background:var(--primary); color:white; border-color:var(--primary); }

.botonExito { background:var(--success); border-color:var(--success); color:white; border:2px solid var(--success); }
.botonExito:hover { background:#5a8d5e; border-color:#5a8d5e; box-shadow:0 8px 16px rgba(107,158,111,0.3); }

.botonDanger { background:var(--danger); border-color:var(--danger); color:white; border:2px solid var(--danger); }
.botonDanger:hover { background:#b64640; border-color:#b64640; box-shadow:0 8px 16px rgba(199,85,80,0.3); }

.botonPequeno { padding:6px 12px; font-size:10px; background:var(--card-bg); color:var(--primary); border:1px solid #2a2a2a; border-radius:10px; cursor:pointer; transition:all 0.2s; font-weight:600; }
.botonPequeno:hover { background:var(--primary); color:white; transform:scale(1.05); }
.botonPequeno.botonDanger { background:var(--danger); border-color:var(--danger); color:white; }
.botonPequeno.botonDanger:hover { background:#b64640; }

.btnCategoriaWrapper { position:relative; display:inline-block; }
.btnEliminarCategoria { position:absolute; right:5px; top:50%; transform:translateY(-50%); padding:3px 8px; font-size:11px; background:var(--danger); border:1px solid var(--danger); color:white; border-radius:15px; cursor:pointer; transition:all 0.2s; opacity:0; pointer-events:none; z-index:10; width:24px; height:24px; display:flex; align-items:center; justify-content:center; }
.btnCategoriaWrapper:hover .btnEliminarCategoria, .btnCategoriaWrapper .boton.activo + .btnEliminarCategoria { opacity:1; pointer-events:auto; }
.btnEliminarCategoria:hover { background:#b64640; transform:translateY(-50%) scale(1.1); }
.btnCategoriaWrapper .boton { padding-right:36px; }

/* ===== TABLES ===== */
table { width:100%; border-collapse:collapse; margin-top:15px; }
table thead { background:rgba(74,124,89,0.1); border-radius:12px 12px 0 0; }
table th { padding:12px 14px; text-align:left; font-weight:700; color:var(--primary); border-bottom:2px solid #2a2a2a; font-size:11px; }
table td { padding:10px 12px; border-bottom:1px solid var(--border-color); color:var(--text-primary); font-size:11px; }
table tr:hover { background:rgba(74,124,89,0.06); }
table tr:first-child th:first-child { border-radius:15px 0 0 0; }
table tr:first-child th:last-child { border-radius:0 15px 0 0; }

/* ===== MODALS ===== */
.modal { display:none; position:fixed; z-index:999; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); }
.contenidoModal { background-color:var(--card-bg); margin:5% auto; padding:0; border-radius:30px; box-shadow:0 20px 60px rgba(0,0,0,0.25); width:90%; max-width:600px; max-height:90vh; overflow:hidden; display:flex; flex-direction:column; border:2px solid #2a2a2a; }

.encabezadoModal { background:linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color:white; padding:20px; border-radius:30px 30px 0 0; display:flex; justify-content:space-between; align-items:center; border-bottom:2px solid #2a2a2a; }
.encabezadoModal h3 { margin:0; font-size:18px; font-weight:800; }

.cerrarModal { background:rgba(255,255,255,0.2); color:white; border:2px solid white; width:36px; height:36px; border-radius:50%; cursor:pointer; transition:all 0.3s; font-size:22px; display:flex; align-items:center; justify-content:center; padding:0; flex-shrink:0; }
.cerrarModal:hover { background:white; color:var(--primary); transform:scale(1.1) rotate(90deg); }

.cajaFormulario { margin:20px; overflow-y:auto; max-height:calc(90vh - 140px); }
#detallesHistorialInv { overflow-y:auto; max-height:calc(90vh - 140px); }

.grupoFormulario { margin-bottom:15px; position:relative; }
.grupoFormulario label { display:block; margin-bottom:6px; font-weight:700; color:var(--primary); font-size:11px; }
.grupoFormulario input, .grupoFormulario select { width:100%; padding:11px; border:2px solid #2a2a2a; border-radius:16px; font-size:13px; transition:all 0.3s; background:#ffffff; color:var(--text-primary); }
.grupoFormulario input:focus, .grupoFormulario select:focus { outline:none; border-color:var(--primary); box-shadow:0 0 16px rgba(74,124,89,0.25); background:#f9fcfb; }

.filaFormulario { display:grid; gap:12px; margin-bottom:12px; }
.filaFormulario-CodigoNombre { grid-template-columns:1fr 3fr; }
.filaFormulario-UnidadCantidadCosto { grid-template-columns:1fr 1fr 1fr; }
.filaFormulario-NombreCategoria { grid-template-columns:2fr 1fr; }
.filaFormulario-UnidadCantidad { grid-template-columns:1fr 1fr; }

/* ===== STATISTICS ===== */
.gridEstadisticas { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; margin-bottom:18px; transition:all 0.3s; max-height:500px; overflow:hidden; }
.gridEstadisticas.contraido { max-height:0; margin-bottom:0; }
.botonToggleEstadisticas { padding:6px 8px !important; min-width:32px; font-size:12px !important; }
.botonToggleEstadisticas.contraido { transform:rotate(-90deg); }
.tarjetaEstadistica { background:linear-gradient(135deg, rgba(74,124,89,0.1) 0%, rgba(139,115,85,0.08) 100%); padding:18px; border-radius:22px; border-left:5px solid var(--primary); border:2px solid #2a2a2a; }
.tarjetaEstadistica h3 { color:var(--primary); font-size:24px; margin-bottom:6px; font-weight:800; }
.tarjetaEstadistica p { color:var(--text-secondary); font-size:11px; margin:0; font-weight:600; }

/* ===== INVENTORY ===== */
.cuerpoInventario { }
.cajaVacia { text-align:center; padding:22px; color:var(--text-secondary); }
.cajaIngredientes { background:rgba(74,124,89,0.1); padding:14px; border-radius:18px; margin:12px 0; border:2px dashed #2a2a2a; }
.elementoIngrediente { background:var(--card-bg); padding:10px 12px; margin-bottom:8px; border-radius:16px; display:flex; justify-content:space-between; align-items:center; border-left:5px solid var(--primary); border:2px solid var(--border-color); transition:all 0.2s; }
.elementoIngrediente:hover { background:rgba(74,124,89,0.03); border-color:var(--primary); }

.barraPorcentaje { position:relative; height:18px; background:rgba(74,124,89,0.15); border-radius:15px; overflow:hidden; min-width:60px; }
.barraPorcentajeRelleno { height:100%; border-radius:15px; transition:width 0.3s; }
.porcentajeAlto { background:linear-gradient(90deg, var(--success) 0%, #7fb375 100%); }
.porcentajeMedio { background:linear-gradient(90deg, var(--warning) 0%, #e0c08b 100%); }
.porcentajeBajo { background:linear-gradient(90deg, var(--danger) 0%, #d97570 100%); }
.textoPorcentaje { position:absolute; top:50%; right:8px; transform:translateY(-50%); font-size:11px; color:var(--text-primary); font-weight:700; }

.desplegableSugerencias { position:absolute; background:var(--card-bg); border:2px solid #2a2a2a; border-radius:18px; max-height:200px; overflow-y:auto; width:calc(100% - 2px); z-index:1000; margin-top:2px; box-shadow:0 12px 32px rgba(0,0,0,0.15); display:none; }
.elementoSugerencia { padding:10px 12px; cursor:pointer; border-bottom:1px solid var(--border-color); transition:background 0.2s; color:var(--text-secondary); }
.elementoSugerencia:hover { background:rgba(74,124,89,0.1); color:var(--primary); font-weight:600; }
.elementoSugerencia:last-child { border-bottom:none; }

.cajaBusqueda { width:260px; padding:10px 14px; border:2px solid #2a2a2a; border-radius:18px; font-size:12px; outline:none; transition:all 0.3s; background:#ffffff; color:var(--text-primary); font-weight:500; max-width:100%; box-sizing:border-box; }
.cajaBusqueda:focus { border-color:var(--primary); box-shadow:0 0 16px rgba(74,124,89,0.25); background:#f9fcfb; }
.cajaBusqueda::placeholder { color:var(--text-secondary); }

/* ===== RECIPES ===== */
.gridRecetas { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:15px; margin-bottom:18px; }
.tarjetaReceta { background:linear-gradient(135deg, rgba(74,124,89,0.1) 0%, rgba(139,115,85,0.08) 100%); border-radius:22px; box-shadow:0 6px 16px rgba(0,0,0,0.1); border:2px solid #2a2a2a; transition:all 0.3s; }
.tarjetaReceta:hover { transform:translateY(-6px); box-shadow:0 12px 28px rgba(74,124,89,0.18); border-color:var(--primary); }
#cuerpoRecetas { display:grid; grid-template-columns:repeat(auto-fill, minmax(260px, 1fr)); gap:15px; }

/* ===== NOTIFICATIONS ===== */
.modalNotificacion { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:var(--card-bg); padding:24px; border-radius:25px; box-shadow:0 20px 60px rgba(0,0,0,0.25); z-index:2000; min-width:280px; text-align:center; animation:slideIn 0.3s; border:2px solid #2a2a2a; }
@keyframes slideIn { from { transform:translate(-50%, -60%); opacity:0; } to { transform:translate(-50%, -50%); opacity:1; } }
.modalNotificacion.exito { border-left:5px solid var(--success); }
.modalNotificacion.error { border-left:5px solid var(--danger); }
.modalNotificacion.advertencia { border-left:5px solid var(--warning); }
.modalNotificacion h3 { margin-bottom:12px; font-weight:800; color:var(--text-primary); font-size:16px; }
.modalNotificacion.exito h3 { color:var(--success); }
.modalNotificacion.error h3 { color:var(--danger); }
.modalNotificacion.advertencia h3 { color:var(--warning); }

.fondoNotificacion { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.3); z-index:1999; }

.selectorPeriodo { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; width:100%; max-width:100%; }
.selectorPeriodo .boton { margin-right:0; margin-bottom:5px; flex:0 1 auto; }

/* ===== IMPORT/EXPORT BUTTONS ===== */
.botonesImportarExportar { display:flex; gap:8px; }
.botonImportar, .botonExportar { padding:7px 12px; border-radius:13px; cursor:pointer; font-size:10px; font-weight:700; transition:all 0.3s; display:flex; align-items:center; gap:5px; border:2px solid #2a2a2a; }
.botonImportar { background:linear-gradient(135deg, rgba(107,158,111,0.2) 0%, rgba(107,158,111,0.1) 100%); color:var(--success); border-color:var(--success); }
.botonImportar:hover { background:var(--success); color:white; transform:translateY(-2px); box-shadow:0 6px 14px rgba(107,158,111,0.3); border-color:var(--success); }
.botonExportar { background:linear-gradient(135deg, rgba(74,124,89,0.2) 0%, rgba(74,124,89,0.1) 100%); color:var(--primary); border-color:var(--primary); }
.botonExportar:hover { background:var(--primary); color:white; transform:translateY(-2px); box-shadow:0 6px 14px rgba(74,124,89,0.3); border-color:var(--primary); }
.inputArchivoOculto { display:none; }


/* ===== RESPONSIVE DESIGN ===== */

/* Tablets (768px - 1024px) */
@media (max-width:1024px) {
  .barraLateral { width:240px; }
  .gridRecetas { grid-template-columns:repeat(auto-fill, minmax(240px, 1fr)); }
  .gridEstadisticas { grid-template-columns:repeat(2, 1fr); }
  .filaFormulario-CodigoNombre { grid-template-columns:1fr 2fr; }
  table thead { font-size:12px; }
  table td, table th { padding:12px 10px; }
  .botonImportar, .botonExportar { padding:6px 10px; font-size:9px; gap:3px; }
}

/* Mobile devices (m√°x 768px) */
@media (max-width:768px) {
  /* Layout */
  body { flex-direction:row; }
  .barraLateral { width:75vw; max-width:320px; height:100vh; position:fixed; left:-100%; transition:left 0.3s ease; top:0; z-index:1998; box-shadow:6px 0 20px rgba(0,0,0,0.15); border-radius:0 30px 30px 0; overflow-y:auto; }
  .barraLateral.mostrada { left:0; }
  .contenidoPrincipal { margin-left:0; padding:15px; height:auto; overflow-x:hidden; }
  .botonToggleMenu { display:flex !important; z-index:2000; position:fixed; top:20px; left:20px; }
  .cierreBarraLateral { display:flex !important; z-index:2001; }
  
  /* Header - Logo centrado con t√≠tulo debajo */
  header { padding:80px 15px 15px 15px; flex-direction:column; gap:15px; margin-bottom:15px; justify-content:center; align-items:center; position:relative; max-height:none; border-radius:25px; }
  header > div:first-child { flex-direction:column !important; align-items:center !important; text-align:center; }
  #logoEncabezado { margin-bottom:0 !important; width:62px !important; height:62px !important; order:-1; }
  .tituloEncabezado { font-size:20px; flex:none; }
  
  /* Header alerts position - z-index menor que el bot√≥n de cerrar */
  header .iconoAlertas { position:absolute; top:20px; right:20px; z-index:1999; }
  
  /* Menu */
  .menuBarraLateral { padding:10px 0; }
  .elementoMenu { padding:13px 18px; font-size:13px; gap:10px; border-radius:0 15px 15px 0; }
  .iconoMenu { font-size:18px; }
  
  /* Cards */
  .tarjeta { padding:18px; margin-bottom:15px; border-radius:24px; width:100%; box-sizing:border-box; overflow-x:hidden; }
  .tarjeta h2 { font-size:18px; margin-bottom:15px; }
  .encabezadoTarjeta { flex-direction:column; gap:10px; align-items:flex-start; flex-wrap:wrap; width:100%; }
  .encabezadoTarjeta > div { width:100%; }
  
  /* Grids */
  .gridEstadisticas { grid-template-columns:repeat(4, 1fr); gap:8px; }
  .tarjetaEstadistica { padding:12px 10px; border-radius:18px; }
  .tarjetaEstadistica h3 { font-size:18px; }
  .tarjetaEstadistica p { font-size:9px; }
  
  .gridRecetas { grid-template-columns:1fr; gap:15px; }
  #cuerpoRecetas { grid-template-columns:1fr !important; gap:15px; }
  
  /* Forms */
  .filaFormulario { gap:10px; }
  .filaFormulario-CodigoNombre { grid-template-columns:1fr; }
  .filaFormulario-UnidadCantidadCosto { grid-template-columns:1fr; }
  .filaFormulario-NombreCategoria { grid-template-columns:1fr; }
  .filaFormulario-UnidadCantidad { grid-template-columns:1fr; }
  .grupoFormulario input, .grupoFormulario select { font-size:16px; padding:13px; border-radius:16px; }
  
  /* Search */
  .cajaBusqueda { width:100%; max-width:100%; border-radius:15px; box-sizing:border-box; }
  
  /* Buttons responsive */
  .botonesImportarExportar { flex-wrap:wrap; width:100%; }
  
  /* Tables */
  table { font-size:11px; width:100%; overflow-x:auto; display:block; }
  table thead, table tbody { display:table; width:100%; }
  table th { padding:10px 6px; font-size:11px; border-radius:0; }
  table td { padding:9px 6px; }
  table thead { font-size:10px; }
  
  /* Buttons */
  .boton { padding:6px 12px; font-size:10px; margin-right:5px; margin-bottom:5px; border-radius:15px; }
  .botonPequeno { padding:5px 10px; font-size:9px; border-radius:10px; }
  .botonImportar, .botonExportar { padding:6px 10px; font-size:9px; gap:3px; border-radius:11px; }
  
  /* Bot√≥n eliminar categor√≠a visible en m√≥viles cuando est√° activa */
  .btnCategoriaWrapper .boton.activo ~ .btnEliminarCategoria { opacity:1; pointer-events:auto; }
  
  /* Modal - Centrado correcto */
  .modal { position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); display:none; z-index:999; }
  .contenidoModal { 
    position:fixed !important; 
    top:50% !important; 
    left:50% !important; 
    transform:translate(-50%, -50%) !important; 
    width:90% !important; 
    max-width:90% !important; 
    max-height:90vh !important; 
    margin:0 !important;
    padding:0;
    border-radius:25px;
    box-shadow:0 8px 24px rgba(0,0,0,0.25);
    background-color:var(--card-bg);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    z-index:1000;
  }
  .encabezadoModal { padding:18px; border-radius:25px 25px 0 0; }
  .encabezadoModal h3 { font-size:18px; }
  .cerrarModal { width:38px; height:38px; font-size:22px; }
  .cajaFormulario { margin:16px; padding:0; overflow-y:auto; max-height:calc(90vh - 110px); }
  
  /* Asegurar que todos los tipos de modal est√©n bien centrados */
  #modalInsumo .contenidoModal,
  #modalAumentarInsumo .contenidoModal,
  #modalUtensilio .contenidoModal,
  #modalEditarUtensilio .contenidoModal,
  #modalHistorialUtensilio .contenidoModal,
  #modalHistorialAgregadoUtensilios .contenidoModal,
  #modalReceta .contenidoModal,
  #modalCategoria .contenidoModal,
  #modalHistorialInv .contenidoModal,
  #modalConfirmacion .contenidoModal {
    position:fixed !important;
    top:50% !important;
    left:50% !important;
    transform:translate(-50%, -50%) !important;
    margin:0 !important;
    width:90% !important;
    max-width:90% !important;
  }
  
  /* Alerts dropdown */
  .desplegableAlertas { width:90vw; right:10px !important; left:auto !important; top:70px !important; max-height:50vh; border-radius:20px; }
  
  /* Notifications */
  .modalNotificacion {
    left:50%;
    top:50%;
    right:auto;
    bottom:auto;
    transform:translate(-50%, -50%);
    width:90vw;
    max-width:90vw;
    max-height:80vh;
    overflow:auto;
    border-radius:24px;
  }
  
  /* Tabs */
  .tabsAlertas { flex-wrap:wrap; }
  .tabAlerta { flex:0 1 auto; border-radius:12px; }
  
  /* Icon alerts size */
  .iconoAlertas { width:44px; height:44px; font-size:20px; border-radius:15px; }
}

/* Phones muy peque√±os (m√°x 480px) */
@media (max-width:480px) {
  .barraLateral { width:80vw; max-width:280px; }
  .contenidoPrincipal { padding:10px; overflow-x:hidden; }
  
  header { padding:70px 12px 12px 12px; border-radius:20px; }
  .tituloEncabezado { font-size:18px; }
  #logoEncabezado { width:55px !important; height:55px !important; }
  
  .tarjeta { padding:12px; border-radius:20px; width:100%; box-sizing:border-box; }
  .tarjeta h2 { font-size:16px; margin-bottom:10px; }
  
  .gridEstadisticas { grid-template-columns:repeat(4, 1fr); gap:6px; }
  .tarjetaEstadistica { padding:8px 6px; border-radius:15px; }
  .tarjetaEstadistica h3 { font-size:16px; }
  .tarjetaEstadistica p { font-size:8px; }
  
  .grupoFormulario { margin-bottom:10px; }
  .grupoFormulario label { font-size:12px; margin-bottom:3px; }
  .grupoFormulario input, .grupoFormulario select { font-size:14px; padding:11px; border-radius:14px; }
  
  table { font-size:9px; }
  table th, table td { padding:5px 2px; }
  
  .boton { padding:5px 10px; font-size:10px; border-radius:12px; }
  .botonPequeno { padding:4px 8px; font-size:8px; border-radius:8px; }
  .botonImportar, .botonExportar { padding:4px 6px; font-size:9px; gap:2px; border-radius:9px; }
  
  /* Modal centrado en pantallas peque√±as */
  .contenidoModal { 
    width:95%; 
    max-width:95%;
    top:50% !important;
    left:50% !important;
    transform:translate(-50%, -50%) !important;
    margin:0 !important;
    border-radius:20px;
  }
  .encabezadoModal h3 { font-size:16px; }
  
  .elementoIngrediente { flex-wrap:wrap; gap:5px; border-radius:15px; }
  
  /* Stack form rows */
  .encabezadoTarjeta { flex-direction:column; gap:8px; }
  
  /* Alerts position for small phones */
  .desplegableAlertas { width:95vw; right:5px !important; left:auto !important; border-radius:18px; }
  
  header .iconoAlertas { width:40px; height:40px; font-size:18px; border-radius:12px; }
}

/* Landscape orientation on phones */
@media (max-height:500px) {
  .barraLateral { min-height:auto; }
  .contenidoPrincipal { padding:10px; }
  .tarjeta { margin-bottom:10px; }
}

</style>
</head>
<body>
<div id="appRoot" style="display:none">
<button class="botonToggleMenu" onclick="alternarBarraLateral()">‚ãÆ</button>
<div class="barraLateral">
  <div class="encabezadoBarraLateral">
    <button class="cierreBarraLateral" onclick="alternarBarraLateral()">√ó</button>
    <img src="images/logo.png" alt="Chipactli" class="logoBarraLateral" id="logoBarraLateral">
    <div>
      <h1>Chipactli</h1>
      <p>Control de Cosm√©tica S√≥lida</p>
    </div>
  </div>
  <div class="menuBarraLateral">
    <a href="#/inventario-produccion" class="elementoMenu activo" onclick="return activarPestanaLink(event, 'produccion')"><span class="iconoMenu">üè≠</span><span>Inventario de Producci√≥n</span></a>
    <a href="#/inventario-insumos" class="elementoMenu" onclick="return activarPestanaLink(event, 'insumos')"><span class="iconoMenu">üì¶</span><span>Inventario de Insumos</span></a>
    <a href="#/inventario-utensilios" class="elementoMenu" onclick="return activarPestanaLink(event, 'utensilios')"><span class="iconoMenu">üß∞</span><span>Inventario de Utensilios</span></a>
    <a href="#/recetas" class="elementoMenu" onclick="return activarPestanaLink(event, 'recetas')"><span class="iconoMenu">üìã</span><span>Recetas</span></a>
    <a href="#/ventas" class="elementoMenu" onclick="return activarPestanaLink(event, 'ventas')"><span class="iconoMenu">üí∞</span><span>Ventas Realizadas</span></a>
    <a href="#" class="elementoMenu" id="btnAdminUsuarios" style="display:none" onclick="irPanelAdminUsuarios();return false;"><span class="iconoMenu">üë§</span><span>Administrar Usuarios</span></a>
    <a href="#" class="elementoMenu" id="btnCerrarSesion" onclick="cerrarSesion();return false;"><span class="iconoMenu">üö™</span><span>Cerrar sesi√≥n</span></a>
  <script>
  // Mostrar bot√≥n de admin solo si es CEO/admin
  document.addEventListener('DOMContentLoaded', function() {
    try {
      const usuario = JSON.parse(localStorage.getItem('usuario'));
      if (usuario && (usuario.rol === 'ceo' || usuario.rol === 'admin')) {
        const btn = document.getElementById('btnAdminUsuarios');
        if (btn) btn.style.display = '';
      }
    } catch {}
  });
  </script>
  </div>
</div>
<div class="contenidoPrincipal">
  <div class="headerCardFijo">
    <div style="flex:1"></div>
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;flex:0 0 auto;">
      <img src="images/logo.png" alt="Chipactli" id="logoEncabezado">
      <h1 class="tituloEncabezado" id="tituloUnitario">Control de Insumos</h1>
    </div>
    <div style="flex:1"></div>
      <div class="iconoAlertas" onclick="alternarAlertas()">
        <span style="position:relative;display:inline-block;">
          üîî
          <span class="distintivo" id="conteoAlertas" style="display:none;position:absolute;top:-10px;right:-10px;">0</span>
        </span>
      </div>
  </div>
    </div>
    <div class="tarjeta">
      <div class="encabezadoTarjeta">
        <h2>Inventario de Insumos</h2>
        <div style="display:flex;gap:10px;align-items:center;justify-content:center;width:100%">
          <input type="text" class="cajaBusqueda" id="busquedaInventario" placeholder="üîç Buscar insumo..." oninput="filtrarInventario(this.value)">
          <div class="botonesImportarExportar">
            <button class="botonImportar" onclick="document.getElementById('importarInventario').click()">üì• Importar</button>
            <input type="file" id="importarInventario" class="inputArchivoOculto" accept=".json" onchange="importarDatos('inventario', this)">
            <button class="botonExportar" onclick="exportarDatos('inventario')">üì§ Exportar</button>
          </div>
          <button class="boton" onclick="abrirModal('modalInsumo')">‚û• Agregar Insumo</button>
          <button class="boton botonDanger" id="btnPendientesInsumos" onclick="window.inventario.mostrarPendientesInsumos()">Productos pendientes</button>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>C√≥digo</th><th>Nombre</th><th>Unidad</th><th>Cantidad Total</th><th>Disponible</th><th>Costo Total</th><th>Costo/Unidad</th><th>Porcentaje</th><th>Acciones</th>
          </tr>
        </thead>
        <tbody id="cuerpoInventario"></tbody>
      </table>
    </div>
  </div>

  <div id="utensilios" class="pestana">
    <div class="tarjeta">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
        <h2>Estad√≠sticas de Utensilios</h2>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="boton" onclick="window.utensilios.mostrarHistorialAgregadoUtensilios()">üìä Historial Agrupado</button>
        </div>
      </div>
      <div class="gridEstadisticas">
        <div class="tarjetaEstadistica"><h3 id="inversionTotalUtensilios">$0.00</h3><p>Inversi√≥n Total</p></div>
        <div class="tarjetaEstadistica"><h3 id="inversionRecuperadaUtensilios">$0.00</h3><p>Inversi√≥n Recuperada</p></div>
        <div class="tarjetaEstadistica"><h3 id="inversionNetaUtensilios">$0.00</h3><p>Inversi√≥n Neta</p></div>
        <div class="tarjetaEstadistica"><h3 id="totalUtensilios">0</h3><p>Total de Utensilios</p></div>
      </div>
    </div>
    <div class="tarjeta">
      <div class="encabezadoTarjeta">
        <h2>Inventario de Utensilios</h2>
        <div style="display:flex;gap:10px">
          <input type="text" class="cajaBusqueda" id="busquedaUtensilios" placeholder="üîç Buscar utensilio..." oninput="filtrarUtensilios(this.value)">
          <div class="botonesImportarExportar">
            <button class="botonImportar" onclick="document.getElementById('importarUtensilios').click()">üì• Importar</button>
            <input type="file" id="importarUtensilios" class="inputArchivoOculto" accept=".json" onchange="importarDatos('utensilios', this)">
            <button class="botonExportar" onclick="exportarDatos('utensilios')">üì§ Exportar</button>
          </div>
          <button class="boton" onclick="abrirModal('modalUtensilio')">‚û• Agregar Utensilio</button>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>C√≥digo</th><th>Nombre</th><th>Unidad</th><th>Cantidad Total</th><th>Costo Total</th><th>Costo/Unidad</th><th>Acciones</th>
          </tr>
        </thead>
        <tbody id="cuerpoUtensilios"></tbody>
      </table>
    </div>
  </div>
  
  <div id="recetas" class="pestana">
    <div class="tarjeta">
      <div class="encabezadoTarjeta">
        <h2>Gesti√≥n de Recetas</h2>
        <div style="display:flex;gap:8px;align-items:center;justify-content:flex-end;flex-wrap:wrap">
          <div class="botonesImportarExportar">
            <button class="botonImportar" onclick="document.getElementById('importarRecetas').click()">üì• Importar</button>
            <input type="file" id="importarRecetas" class="inputArchivoOculto" accept=".json" onchange="importarDatos('recetas', this)">
            <button class="botonExportar" onclick="exportarDatos('recetas')">üì§ Exportar</button>
          </div>
          <button class="boton" onclick="abrirModal('modalCategoria')">‚ûï Nueva Categor√≠a</button>
          <button class="boton" onclick="abrirModal('modalReceta')">‚û• Nueva Receta</button>
        </div>
      </div>
      <div style="display:flex;justify-content:center;margin-bottom:15px">
        <input type="text" class="cajaBusqueda" id="busquedaRecetas" placeholder="üîç Buscar receta..." oninput="filtrarRecetas(this.value)" style="width:220px">
      </div>
      <div id="pestanasCategoriasRecetas" style="display:flex;gap:5px;flex-wrap:wrap;margin-bottom:15px"></div>
      <div id="cuerpoRecetas" class="gridRecetas"></div>
    </div>
  </div>
  
  <div id="ventas" class="pestana">
    <div class="tarjeta">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;flex-wrap:wrap;gap:10px">
        <h2>An√°lisis de Ventas</h2>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <div class="botonesImportarExportar">
            <button class="botonImportar" onclick="document.getElementById('importarVentas').click()">üì• Importar</button>
            <input type="file" id="importarVentas" class="inputArchivoOculto" accept=".json" onchange="importarDatos('ventas', this)">
            <button class="botonExportar" onclick="exportarDatos('ventas')">üì§ Exportar</button>
          </div>
          <div class="selectorPeriodo">
            <button class="boton" onclick="cargarEstadisticasVentas('dia')">Hoy</button>
            <button class="boton" onclick="cargarEstadisticasVentas('semana')">Esta Semana</button>
            <button class="boton" onclick="cargarEstadisticasVentas('quincena')">Quincena</button>
            <button class="boton" onclick="cargarEstadisticasVentas('mes')">Este Mes</button>
          </div>
        </div>
      </div>
      <div id="pestanasCategoriasVentas" style="display:flex;gap:5px;margin-bottom:15px;flex-wrap:wrap"></div>
      <div class="gridEstadisticas">
        <div class="tarjetaEstadistica"><h3 id="ingresosTotal">$0</h3><p>Ingresos</p></div>
        <div class="tarjetaEstadistica"><h3 id="costosTotal">$0</h3><p>Costos</p></div>
        <div class="tarjetaEstadistica"><h3 id="gananciaTotal">$0</h3><p>Ganancia</p></div>
        <div class="tarjetaEstadistica"><h3 id="unidadesVendidas">0</h3><p>Unidades Vendidas</p></div>
      </div>
    </div>
    <div class="tarjeta">
      <h2>Historial de Ventas</h2>
      <table>
        <thead>
          <tr>
            <th>Receta</th><th>Categor√≠a</th><th>Cantidad</th><th>Pedido</th><th>Fecha Producci√≥n</th><th>Fecha Venta</th><th>Costo</th><th>Venta</th><th>Ganancia</th><th>Acciones</th>
          </tr>
        </thead>
        <tbody id="cuerpoVentas"></tbody>
      </table>
    </div>
    <div class="tarjeta">
      <h2>Historial de Cortes√≠as</h2>
      <table>
        <thead>
          <tr>
            <th>Receta</th><th>Cantidad</th><th>Pedido</th><th>Motivo</th><th>Para qui√©n</th><th>Fecha y hora</th>
          </tr>
        </thead>
        <tbody id="cuerpoCortesias"></tbody>
      </table>
    </div>
  </div>
</div>



<!-- ===== MODALES ===== -->

<div id="modalInsumo" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Agregar Insumo al Inventario</h3><button class="cerrarModal" onclick="cerrarModal('modalInsumo')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioInsumo" onsubmit="agregarInsumo(event)">
        <div class="filaFormulario" style="display:flex;gap:10px;align-items:end;">
          <div class="grupoFormulario" style="flex:2;">
            <label for="nombreInsumo" style="font-size:18px;font-weight:700;">Nombre *</label>
            <input type="text" id="nombreInsumo" required style="font-size:18px;font-weight:700;">
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="gramajeInsumo" style="font-size:13px;">Gramaje</label>
            <input type="number" id="gramajeInsumo" step="0.01" placeholder="0.00">
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="categoriaInsumo" style="font-size:13px;">Categor√≠a</label>
            <select id="categoriaInsumo" style="font-size:13px;">
              <option value="">Sin categor√≠a</option>
              <option value="Abarrotes">Abarrotes</option>
              <option value="Bebidas">Bebidas</option>
              <option value="Carnes">Carnes</option>
              <option value="L√°cteos">L√°cteos</option>
              <option value="Frutas">Frutas</option>
              <option value="Verduras">Verduras</option>
              <option value="Otros">Otros</option>
            </select>
          </div>
        </div>
        <div class="filaFormulario" style="display:flex;gap:10px;align-items:end;margin-top:8px;">
          <div class="grupoFormulario" style="flex:1;">
            <label for="codigoInsumo">C√≥digo *</label>
            <input type="text" id="codigoInsumo" required>
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="unidadInsumo">Unidad *</label>
            <select id="unidadInsumo" required>
              <option value="">Seleccionar</option>
              <option value="g">Gramos (g)</option>
              <option value="ml">Mililitros (ml)</option>
              <option value="kg">Kilogramos (kg)</option>
              <option value="l">Litros (l)</option>
              <option value="pz">Piezas (pz)</option>
              <option value="cda">Cucharadas (cda)</option>
              <option value="cdta">Cucharaditas (cdta)</option>
              <option value="taza">Tazas</option>
              <option value="oz">Onzas (oz)</option>
              <option value="Gotas">Gotas (go)</option>
            </select>
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="cantidadInsumo">Cantidad *</label>
            <input type="number" id="cantidadInsumo" step="0.01" placeholder="0.00" required>
          </div>
        </div>
        <div class="filaFormulario" style="display:flex;gap:10px;align-items:end;margin-top:8px;">
          <div class="grupoFormulario" style="flex:1;">
            <label for="costoInsumo">Costo Total *</label>
            <input type="number" id="costoInsumo" step="0.01" placeholder="$0.00" required>
          </div>
        </div>
        <button type="submit" class="boton botonExito">Guardar</button>
        <button type="button" class="boton" onclick="cerrarModal('modalInsumo')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalAumentarInsumo" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Aumentar Cantidad de Insumo</h3><button class="cerrarModal" onclick="cerrarModal('modalAumentarInsumo')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioAumentarInsumo" onsubmit="window.inventario.guardarAumentarInsumo(event)">
        <input type="hidden" id="aumentarInsumoId">
        <div class="grupoFormulario">
          <label>Insumo</label>
          <input type="text" id="aumentarInsumoNombre" readonly style="background:#f5f5f5;cursor:not-allowed">
        </div>
        <div class="filaFormulario">
          <div class="grupoFormulario"><label>Cantidad a Agregar *</label><input type="number" id="aumentarCantidad" step="0.01" placeholder="0.00" required></div>
          <div class="grupoFormulario"><label>Costo Total *</label><input type="number" id="aumentarCosto" step="0.01" placeholder="$0.00" required></div>
        </div>
        <button type="submit" class="boton botonExito">Guardar</button>
        <button type="button" class="boton" onclick="cerrarModal('modalAumentarInsumo')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalUtensilio" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Agregar Utensilio</h3><button class="cerrarModal" onclick="cerrarModal('modalUtensilio')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioUtensilio" onsubmit="agregarUtensilio(event)">
        <div class="filaFormulario filaFormulario-CodigoNombre">
          <div class="grupoFormulario"><label>C√≥digo *</label><input type="text" id="codigoUtensilio" required></div>
          <div class="grupoFormulario"><label>Nombre *</label><input type="text" id="nombreUtensilio" required></div>
        </div>
        <div class="filaFormulario filaFormulario-UnidadCantidadCosto">
          <div class="grupoFormulario"><label>Unidad *</label><select id="unidadUtensilio" required>
            <option value="">Seleccionar</option>
            <option value="pz">Piezas (pz)</option>
            <option value="jgo">Juego</option>
            <option value="set">Set</option>
          </select></div>
          <div class="grupoFormulario"><label>Cantidad *</label><input type="number" id="cantidadUtensilio" step="0.01" placeholder="0.00" required></div>
          <div class="grupoFormulario"><label>Costo Total *</label><input type="number" id="costoUtensilio" step="0.01" placeholder="$0.00" required></div>
        </div>
        <button type="submit" class="boton botonExito">Guardar</button>
        <button type="button" class="boton" onclick="cerrarModal('modalUtensilio')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalEditarUtensilio" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Editar Utensilio</h3><button class="cerrarModal" onclick="cerrarModal('modalEditarUtensilio')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioEditarUtensilio" onsubmit="guardarEditarUtensilio(event)">
        <input type="hidden" id="idEditUtensilio">
        <div class="filaFormulario filaFormulario-CodigoNombre">
          <div class="grupoFormulario"><label>C√≥digo *</label><input type="text" id="editCodigoUtensilio" disabled></div>
          <div class="grupoFormulario"><label>Nombre *</label><input type="text" id="editNombreUtensilio" required></div>
        </div>
        <div class="filaFormulario filaFormulario-UnidadCantidadCosto">
          <div class="grupoFormulario"><label>Unidad *</label><select id="editUnidadUtensilio" required>
            <option value="">Seleccionar</option>
            <option value="pz">Piezas (pz)</option>
            <option value="jgo">Juego</option>
            <option value="set">Set</option>
          </select></div>
          <div class="grupoFormulario"><label>Cantidad *</label><input type="number" id="editCantidadUtensilio" step="0.01" placeholder="0.00" required></div>
          <div class="grupoFormulario"><label>Costo Total *</label><input type="number" id="editCostoUtensilio" step="0.01" placeholder="$0.00" required></div>
        </div>
        <button type="submit" class="boton botonExito">Guardar</button>
        <button type="button" class="boton" onclick="cerrarModal('modalEditarUtensilio')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalHistorialUtensilio" class="modal">
  <div class="contenidoModal" style="max-width:600px">
    <div class="encabezadoModal">
      <h3 id="tituloHistorialUtensilio">Historial de Utensilio</h3>
      <button class="cerrarModal" onclick="cerrarModal('modalHistorialUtensilio')">&times;</button>
    </div>
    <div style="padding:20px">
      <table>
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Cantidad</th>
            <th>Costo</th>
          </tr>
        </thead>
        <tbody id="cuerpoHistorialUtensilio"></tbody>
      </table>
    </div>
  </div>
</div>

<div id="modalHistorialAgregadoUtensilios" class="modal">
  <div class="contenidoModal" style="max-width:800px;max-height:600px;overflow-y:auto">
    <div class="encabezadoModal">
      <h3>Historial Agrupado de Inversi√≥n en Utensilios</h3>
      <button class="cerrarModal" onclick="cerrarModal('modalHistorialAgregadoUtensilios')">&times;</button>
    </div>
    <div style="padding:20px" id="listaHistorialAgregadoUtensilios"></div>
  </div>
</div>

<div id="modalCategoria" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Nueva Categor√≠a</h3><button class="cerrarModal" onclick="cerrarModal('modalCategoria')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioCategoria" onsubmit="agregarCategoria(event)">
        <div class="grupoFormulario"><label>Nombre de la Categor√≠a *</label><input type="text" id="nombreCategoria" required></div>
        <button type="submit" class="boton botonExito">Guardar</button>
        <button type="button" class="boton" onclick="cerrarModal('modalCategoria')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalReceta" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Nueva Receta</h3><button class="cerrarModal" onclick="cerrarModal('modalReceta')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioReceta" onsubmit="agregarReceta(event)">
        <div class="filaFormulario" style="display:flex;gap:10px;align-items:end;">
          <div class="grupoFormulario" style="flex:2;">
            <label for="nombreReceta" style="font-size:17px;font-weight:700;">Nombre de la Receta *</label>
            <input type="text" id="nombreReceta" required style="font-size:17px;font-weight:700;">
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="gramajeReceta" style="font-size:13px;">Gramaje (g) *</label>
            <input type="number" id="gramajeReceta" step="0.01" placeholder="0.00" required>
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="categoriaReceta" style="font-size:13px;">Categor√≠a *</label>
            <select id="categoriaReceta" required style="font-size:13px;"></select>
          </div>
        </div>
        <h4 style="margin-top:20px;margin-bottom:10px">Ingredientes</h4>
        <div class="filaFormulario" style="display:flex;gap:10px;align-items:end;margin-bottom:10px;">
          <div class="grupoFormulario" style="flex:2;">
            <label>C√≥digo o Nombre del Insumo</label>
            <input type="text" id="insumoSeleccionado" placeholder="Buscar por c√≥digo o nombre" autocomplete="off" oninput="buscarInsumoParaReceta(this.value)">
            <div id="listaBusquedaInsumos" class="desplegableSugerencias"></div>
            <input type="hidden" id="idInsumoSeleccionado">
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label>Unidad</label>
            <select id="unidadIngrediente" required disabled>
              <option value="">Seleccionar</option>
              <option value="g">Gramos (g)</option>
              <option value="ml">Mililitros (ml)</option>
              <option value="kg">Kilogramos (kg)</option>
              <option value="l">Litros (l)</option>
              <option value="pz">Piezas (pz)</option>
              <option value="cda">Cucharadas (cda)</option>
              <option value="cdta">Cucharaditas (cdta)</option>
              <option value="taza">Tazas</option>
              <option value="oz">Onzas (oz)</option>
              <option value="Gotas">Gotas (go)</option>
            </select>
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label>Cantidad *</label>
            <input type="number" id="cantidadIngrediente" step="0.01" placeholder="0.00">
          </div>
        </div>
        <button type="button" class="boton" onclick="agregarIngrediente()">‚ûï Agregar Ingrediente</button>
        <table style="margin-top:15px;border:1px solid #ddd;border-radius:8px;overflow:hidden">
          <thead>
            <tr style="background:#f5f5f5">
              <th style="text-align:left">Insumo</th>
              <th>Cantidad</th>
              <th style="width:50px">Acci√≥n</th>
            </tr>
          </thead>
          <tbody id="tablaIngredientesTemporales"></tbody>
        </table>
        <div style="margin-top:20px"><button type="submit" class="boton botonExito">Guardar Receta</button><button type="button" class="boton" onclick="cerrarModal('modalReceta')">Cancelar</button></div>
      </form>
    </div>
  </div>
</div>

<div id="modalIngredientes" class="modal">
  <div class="contenidoModal" style="max-width:550px;max-height:85vh">
    <div class="encabezadoModal"><h3>Ingredientes de la Receta</h3><button class="cerrarModal" onclick="cerrarModal('modalIngredientes')">&times;</button></div>
    <div id="detallesIngredientes" style="padding:15px;max-height:calc(85vh - 80px);overflow-y:auto"></div>
  </div>
</div>

<div id="modalEscalarReceta" class="modal">
  <div class="contenidoModal" style="max-width:450px">
    <div class="encabezadoModal"><h3>Escalar Receta</h3><button class="cerrarModal" onclick="cerrarModal('modalEscalarReceta')">&times;</button></div>
    <div style="padding:20px">
      <input type="hidden" id="idRecetaEscalar">
      <div class="grupoFormulario">
        <label>Gramaje Original</label>
        <input type="text" id="gramajeOriginal" readonly style="background:#f0f0f0">
      </div>
      <div class="grupoFormulario">
        <label>Nuevo Gramaje (g) *</label>
        <input type="number" id="nuevoGramaje" step="0.01" placeholder="Ej: 1000" required>
      </div>

      <div class="headerCardFijo">
        <img src="images/logo.png" alt="Chipactli" id="logoEncabezado" style="display: block;">
        <h1 class="tituloEncabezado" id="tituloUnitario">Control de Insumos</h1>
        <div class="iconoAlertas" onclick="alternarAlertas()">üîî<span class="distintivo" id="conteoAlertas">0</span></div>
      </div>
</div>

<div id="modalHistorialInv" class="modal">
  <div class="contenidoModal" style="max-width:700px">
    <div class="encabezadoModal">
      <h3>Historial de Inversiones por D√≠a</h3>
      <button class="cerrarModal" onclick="cerrarModal('modalHistorialInv')">&times;</button>
    </div>
    <div id="detallesHistorialInv" style="padding:20px">
      <div id="listaHistorialPorFecha"></div>
    </div>
  </div>
</div>

<div id="modalVentaPedido" class="modal">
  <div class="contenidoModal" style="max-width:420px">
    <div class="encabezadoModal"><h3>Registrar Venta</h3><button class="cerrarModal" onclick="cerrarModal('modalVentaPedido')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioVentaPedido" onsubmit="confirmarVentaPedido(event)">
        <div class="grupoFormulario"><label>N√∫mero de pedido *</label><input type="text" id="numeroPedidoVenta" required></div>
        <button type="submit" class="boton botonExito">Registrar</button>
        <button type="button" class="boton" onclick="cerrarModal('modalVentaPedido')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalCortesia" class="modal">
  <div class="contenidoModal" style="max-width:500px">
    <div class="encabezadoModal"><h3>Registrar Cortes√≠a</h3><button class="cerrarModal" onclick="cerrarModal('modalCortesia')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioCortesia" onsubmit="confirmarCortesia(event)">
        <div class="grupoFormulario"><label>N√∫mero de pedido *</label><input type="text" id="numeroPedidoCortesia" required></div>
        <div class="grupoFormulario"><label>Motivo *</label><input type="text" id="motivoCortesia" required></div>
        <div class="grupoFormulario"><label>Para qui√©n</label><input type="text" id="paraQuienCortesia" placeholder="Opcional"></div>
        <button type="submit" class="boton botonExito">Registrar</button>
        <button type="button" class="boton" onclick="cerrarModal('modalCortesia')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalEditarInsumo" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Editar Insumo</h3><button class="cerrarModal" onclick="cerrarModal('modalEditarInsumo')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioEditarInsumo" onsubmit="guardarEditarInsumo(event)">
        <input type="hidden" id="idEditInsumo">
        <div class="filaFormulario filaFormulario-CodigoNombre">
          <div class="grupoFormulario"><label>C√≥digo *</label><input type="text" id="editCodigoInsumo"></div>
          <div class="grupoFormulario"><label>Nombre *</label><input type="text" id="editNombreInsumo" required></div>
        </div>
        <div class="filaFormulario filaFormulario-UnidadCantidadCosto">
          <div class="grupoFormulario"><label>Unidad *</label><select id="editUnidadInsumo" required>
            <option value="">Seleccionar</option>
            <option value="g">Gramos (g)</option>
            <option value="ml">Mililitros (ml)</option>
            <option value="kg">Kilogramos (kg)</option>
            <option value="l">Litros (l)</option>
            <option value="pz">Piezas (pz)</option>
            <option value="cda">Cucharadas (cda)</option>
            <option value="cdta">Cucharaditas (cdta)</option>
            <option value="taza">Tazas</option>
            <option value="oz">Onzas (oz)</option>
            <option value="Gotas">Gotas (go)</option>
          </select></div>
          <div class="grupoFormulario"><label>Cantidad *</label><input type="number" id="editCantidadInsumo" step="0.01" placeholder="0.00" required></div>
          <div class="grupoFormulario"><label>Costo Total *</label><input type="number" id="editCostoInsumo" step="0.01" placeholder="$0.00" required></div>
        </div>
        <button type="submit" class="boton botonExito">Guardar Cambios</button>
        <button type="button" class="boton" onclick="cerrarModal('modalEditarInsumo')">Cancelar</button>
      </form>
    </div>
  </div>
</div>

<div id="modalEditarReceta" class="modal">
  <div class="contenidoModal">
    <div class="encabezadoModal"><h3>Editar Receta</h3><button class="cerrarModal" onclick="cerrarModal('modalEditarReceta')">&times;</button></div>
    <div class="cajaFormulario">
      <form id="formularioEditarReceta" onsubmit="guardarEditarReceta(event)">
        <input type="hidden" id="idEditReceta">
        <div class="filaFormulario" style="display:flex;gap:10px;align-items:end;">
          <div class="grupoFormulario" style="flex:2;">
            <label for="editNombreReceta" style="font-size:17px;font-weight:700;">Nombre de la Receta *</label>
            <input type="text" id="editNombreReceta" required style="font-size:17px;font-weight:700;">
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="editGramajeReceta" style="font-size:13px;">Gramaje (g) *</label>
            <input type="number" id="editGramajeReceta" step="0.01" placeholder="0.00" required>
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label for="editCategoriaReceta" style="font-size:13px;">Categor√≠a *</label>
            <select id="editCategoriaReceta" required style="font-size:13px;"></select>
          </div>
        </div>
        <h4 style="margin-top:20px;margin-bottom:10px">Ingredientes</h4>
        <div class="filaFormulario" style="display:flex;gap:10px;align-items:end;margin-bottom:10px;">
          <div class="grupoFormulario" style="flex:2;">
            <label>C√≥digo o Nombre del Insumo</label>
            <input type="text" id="editInsumoSeleccionado" placeholder="Buscar por c√≥digo o nombre" autocomplete="off" oninput="buscarInsumoParaReceta(this.value)">
            <div id="editListaBusquedaInsumos" class="desplegableSugerencias"></div>
            <input type="hidden" id="editIdInsumoSeleccionado">
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label>Unidad</label>
            <select id="editUnidadIngrediente" required disabled>
              <option value="">Seleccionar</option>
              <option value="g">Gramos (g)</option>
              <option value="ml">Mililitros (ml)</option>
              <option value="kg">Kilogramos (kg)</option>
              <option value="l">Litros (l)</option>
              <option value="pz">Piezas (pz)</option>
              <option value="cda">Cucharadas (cda)</option>
              <option value="cdta">Cucharaditas (cdta)</option>
              <option value="taza">Tazas</option>
              <option value="oz">Onzas (oz)</option>
              <option value="Gotas">Gotas (go)</option>
            </select>
          </div>
          <div class="grupoFormulario" style="flex:1;">
            <label>Cantidad *</label>
            <input type="number" id="editCantidadIngrediente" step="0.01" placeholder="0.00">
          </div>
        </div>
        <button type="button" class="boton" onclick="agregarIngrediente(true)">‚ûï Agregar Ingrediente</button>
        <table style="margin-top:15px;border:1px solid #ddd;border-radius:8px;overflow:hidden">
          <thead>
            <tr style="background:#f5f5f5">
              <th style="text-align:left">Insumo</th>
              <th>Cantidad</th>
              <th style="width:50px">Acci√≥n</th>
            </tr>
          </thead>
          <tbody id="editTablaIngredientesTemporales"></tbody>
        </table>
        <div style="margin-top:20px"><button type="submit" class="boton botonExito">Guardar Cambios</button><button type="button" class="boton" onclick="cerrarModal('modalEditarReceta')">Cancelar</button></div>
      </form>
    </div>
  </div>
</div>

<div id="modalConfirmacion" class="modal">
  <div class="contenidoModal" style="max-width:420px">
    <div class="encabezadoModal">
      <h3 id="tituloConfirmacion">Confirmar</h3>
      <button class="cerrarModal" onclick="document.getElementById('btnConfirmacionCancelar').click()">&times;</button>
    </div>
    <div class="cajaFormulario" style="padding:20px">
      <p id="textoConfirmacion" style="margin-bottom:18px;color:#333"></p>
      <div style="display:flex;justify-content:flex-end;gap:10px">
        <button id="btnConfirmacionCancelar" class="boton">Cancelar</button>
        <button id="btnConfirmacionAceptar" class="boton botonExito">Aceptar</button>
      </div>
    </div>
  </div>
</div>

<div id="fondoNotificacion" class="fondoNotificacion"></div>
<div id="modalNotificacion" class="modalNotificacion">
  <h3 id="tituloNotificacion">‚úì √âxito</h3>
  <p id="mensajeNotificacion">Operaci√≥n completada</p>
  <button class="boton botonExito" onclick="cerrarNotificacion()" style="margin-top:15px">Aceptar</button>
</div>

<!-- Registro del Service Worker para PWA -->
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/sw.js')
      .then((registration) => {
        console.log('‚úÖ Service Worker registrado:', registration);
        
        // Verificar actualizaciones cada hora
        setInterval(() => {
          registration.update();
        }, 3600000);
      })
      .catch((error) => {
        console.log('‚ùå Error al registrar Service Worker:', error);
      });
  });

  // Detectar cuando hay una nueva versi√≥n disponible
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    if (confirm('üîÑ Hay una nueva versi√≥n disponible. ¬øRecargar la aplicaci√≥n?')) {
      window.location.reload();
    }
  });
}

// Bot√≥n de instalaci√≥n de PWA
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  
  // Mostrar bot√≥n de instalaci√≥n (puedes customizar esto)
  console.log('üì± La app se puede instalar');
  
  // Opcional: Mostrar un banner o bot√≥n para instalar
  const installButton = document.createElement('button');
  installButton.textContent = 'üì± Instalar App';
  installButton.style.cssText = 'position:fixed;bottom:20px;right:20px;padding:12px 24px;background:#4CAF50;color:white;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;box-shadow:0 4px 8px rgba(0,0,0,0.3);z-index:10000;';
  installButton.id = 'installAppButton';
  
  installButton.addEventListener('click', async () => {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`Usuario ${outcome === 'accepted' ? 'acept√≥' : 'rechaz√≥'} la instalaci√≥n`);
      deferredPrompt = null;
      installButton.remove();
    }
  });
  
  document.body.appendChild(installButton);
});

// Cuando la app ya est√° instalada
window.addEventListener('appinstalled', () => {
  console.log('‚úÖ App instalada exitosamente');
  deferredPrompt = null;
  const installButton = document.getElementById('installAppButton');
  if (installButton) installButton.remove();
});
</script>

<script src="app.js"></script>
<script src="utils/importar-exportar.js"></script>
<script type="module" src="main.js"></script>
<script>
// Mostrar app solo si hay token v√°lido
if (localStorage.getItem('token')) {
  document.getElementById('appRoot').style.display = '';
}
</script>
</body>
</html>
